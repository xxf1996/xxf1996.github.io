<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"note.xiexuefeng.cc","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":true,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"manual","top_n_per_article":-1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å‰è¨€ bge-m3 æ˜¯ç”± BAAI åœ¨ 2024 å¹´æ¨å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„ Embedding æ¨¡å‹ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒå¤šè¯­è¨€çš„ Embedding æ¨¡å‹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒè¾“å‡ºç¨€ç–å‘é‡å’Œ ColBERT å‘é‡ï¼Œå› æ­¤ç”¨é€”æ¯”è¾ƒå¹¿æ³›ã€‚æŒ‰ç…§ç›®å‰ AI æ¨¡å‹çš„å‘å±•é€Ÿåº¦ï¼ˆç«äº‰å¾ˆæ¿€çƒˆï¼‰ï¼Œè¿™ä¸ªæ¨å‡ºäº†ä¸€å¹´å¤šçš„æ¨¡å‹ç†åº”ç®—æ˜¯ä¸ªè€å¤è‘£äº†ï¼Œå®é™…ä¸Šåˆ°ç›®å‰ä¸ºæ­¢ï¼ˆ2025-9-20ï¼‰ï¼Œè¯¥æ¨¡å‹è¿˜èƒ½åœ¨ MTEB Leaderboard æ¦œ">
<meta property="og:type" content="article">
<meta property="og:title" content="åŸºäºbge-m3 onnxæ¨¡å‹è·å–ç¨€ç–å‘é‡">
<meta property="og:url" content="https://note.xiexuefeng.cc/post/sparse-vector-generation-with-bge-m3-onnx/index.html">
<meta property="og:site_name" content="snowdream">
<meta property="og:description" content="å‰è¨€ bge-m3 æ˜¯ç”± BAAI åœ¨ 2024 å¹´æ¨å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„ Embedding æ¨¡å‹ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒå¤šè¯­è¨€çš„ Embedding æ¨¡å‹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒè¾“å‡ºç¨€ç–å‘é‡å’Œ ColBERT å‘é‡ï¼Œå› æ­¤ç”¨é€”æ¯”è¾ƒå¹¿æ³›ã€‚æŒ‰ç…§ç›®å‰ AI æ¨¡å‹çš„å‘å±•é€Ÿåº¦ï¼ˆç«äº‰å¾ˆæ¿€çƒˆï¼‰ï¼Œè¿™ä¸ªæ¨å‡ºäº†ä¸€å¹´å¤šçš„æ¨¡å‹ç†åº”ç®—æ˜¯ä¸ªè€å¤è‘£äº†ï¼Œå®é™…ä¸Šåˆ°ç›®å‰ä¸ºæ­¢ï¼ˆ2025-9-20ï¼‰ï¼Œè¯¥æ¨¡å‹è¿˜èƒ½åœ¨ MTEB Leaderboard æ¦œ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202509201703684.png?imageslim">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202509201703779.png?imageslim">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202509211050304.png?imageslim">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202509211203972.png?imageslim">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202509211221914.png?imageslim">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202510041615944.png?imageslim">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202509181018918.png?imageslim">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202510041703815.png?imageslim">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202506031624598.png?imageslim">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202506031629640.png?imageslim">
<meta property="og:image" content="https://assets.zilliz.com/Exploring_BGE_M3_and_Splade_Two_Machine_Learning_Models_for_Generating_Sparse_Embeddings_a3065f09cd.png">
<meta property="og:image" content="https://zilliz.com/favicon.svg">
<meta property="og:image" content="https://assets.zilliz.com/Enhancing_Information_Retrieval_with_Learned_Sparse_Embeddings_a89ddba8f8.png">
<meta property="og:image" content="https://zilliz.com/favicon.svg">
<meta property="og:image" content="https://pic.xiexuefeng.cc/markdown/202509181026829.png?imageslim">
<meta property="article:published_time" content="2025-10-05T02:37:31.000Z">
<meta property="article:modified_time" content="2025-10-05T09:12:51.985Z">
<meta property="article:author" content="xuefeng">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="RAG">
<meta property="article:tag" content="Embedding">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.xiexuefeng.cc/markdown/202509201703684.png?imageslim">


<link rel="canonical" href="https://note.xiexuefeng.cc/post/sparse-vector-generation-with-bge-m3-onnx/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://note.xiexuefeng.cc/post/sparse-vector-generation-with-bge-m3-onnx/","path":"post/sparse-vector-generation-with-bge-m3-onnx/","title":"åŸºäºbge-m3 onnxæ¨¡å‹è·å–ç¨€ç–å‘é‡"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>åŸºäºbge-m3 onnxæ¨¡å‹è·å–ç¨€ç–å‘é‡ | snowdream</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

<style>
.cardlink-wrapper {
  margin: 1.5em 0;
  overflow: hidden;
}

.cardlink {
  display: flex;
  border: 1px solid #e1e4e8;
  border-radius: 8px;
  overflow: hidden;
  text-decoration: none;
  color: inherit;
  transition: all 0.3s ease;
  background: #fff;
}

.cardlink:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  transform: translateY(-2px);
  border-color: #d1d5da;
}

.cardlink-image {
  flex-shrink: 0;
  width: 200px;
  overflow: hidden;
  background: #f6f8fa;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cardlink-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
  margin-bottom: 0px;
}

.cardlink:hover .cardlink-image img {
  transform: scale(1.05);
}

.cardlink-content {
  flex: 1;
  padding: 16px 20px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-width: 0;
}

.cardlink-title {
  font-size: 16px;
  font-weight: 600;
  color: #24292e;
  margin-bottom: 8px;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  line-height: 1.4;
}

.cardlink-description {
  font-size: 14px;
  color: #586069;
  line-height: 1.5;
  margin-bottom: 12px;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  flex: 1;
}

.cardlink-footer {
  display: flex;
  align-items: center;
  font-size: 13px;
  color: #6a737d;
}

.cardlink-favicon {
  width: 16px;
  height: 16px;
  margin-right: 6px;
  margin-bottom: 0px !important;
  flex-shrink: 0;
}

.cardlink-host {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.cardlink-error {
  padding: 12px 16px;
  border: 1px solid #f85149;
  border-radius: 6px;
  background: #fff1f0;
  color: #d1242f;
  margin: 1em 0;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .cardlink {
    flex-direction: column;
  }
  
  .cardlink-image {
    width: 100%;
  }
  
  .cardlink-content {
    padding: 14px 16px;
  }
}

/* æ·±è‰²æ¨¡å¼æ”¯æŒ */
@media (prefers-color-scheme: dark) {
  .cardlink {
    background: #1e1e1e;
    border-color: #30363d;
  }
  
  .cardlink:hover {
    border-color: #484f58;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }
  
  .cardlink-image {
    background: #0d1117;
  }
  
  .cardlink-title {
    color: #c9d1d9;
  }
  
  .cardlink-description {
    color: #8b949e;
  }
  
  .cardlink-footer {
    color: #8b949e;
  }
  
  .cardlink-error {
    background: #2d1417;
    border-color: #f85149;
    color: #ff7b72;
  }
}
</style>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">snowdream</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">record and share</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text"> å‰è¨€</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-embedding-%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.1.</span> <span class="nav-text"> ä»€ä¹ˆæ˜¯ Embedding æ¨¡å‹ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-onnx-%E6%A8%A1%E5%9E%8B"><span class="nav-number">2.</span> <span class="nav-text"> ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ onnx æ¨¡å‹ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E7%90%86%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="nav-number">2.1.</span> <span class="nav-text"> æ¨ç†æ€§èƒ½å¯¹æ¯”</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%A7%8B%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%8E%A8%E7%90%86%E9%80%9F%E5%BA%A6"><span class="nav-number">2.1.1.</span> <span class="nav-text"> åŸå§‹æ¨¡å‹çš„æ¨ç†é€Ÿåº¦</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#onnx-%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%8E%A8%E7%90%86%E9%80%9F%E5%BA%A6"><span class="nav-number">2.1.2.</span> <span class="nav-text"> onnx æ¨¡å‹çš„æ¨ç†é€Ÿåº¦</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.2.</span> <span class="nav-text"> æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#bge-m3-%E7%A8%80%E7%96%8F%E5%90%91%E9%87%8F%E7%9A%84%E8%AE%A1%E7%AE%97"><span class="nav-number">3.</span> <span class="nav-text"> bge-m3 ç¨€ç–å‘é‡çš„è®¡ç®—</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.1.</span> <span class="nav-text"> ä»£ç å®ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sparse_linear-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">3.2.</span> <span class="nav-text"> sparse_linear çš„ä½œç”¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">3.3.</span> <span class="nav-text"> ç‰¹æ®Šå­—ç¬¦çš„å¤„ç†</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BBlearned-sparse-embedding"><span class="nav-number">4.</span> <span class="nav-text"> æ‰©å±•é˜…è¯»ï¼šLearned Sparse Embedding</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#spade"><span class="nav-number">4.1.</span> <span class="nav-text"> spade</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="xuefeng"
      src="/images/photo.jpg">
  <p class="site-author-name" itemprop="name">xuefeng</p>
  <div class="site-description" itemprop="description">æ—¶ä¸æˆ‘å¾…</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">111</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">84</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/xxf1996" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;xxf1996" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://note.xiexuefeng.cc/post/sparse-vector-generation-with-bge-m3-onnx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.jpg">
      <meta itemprop="name" content="xuefeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="snowdream">
      <meta itemprop="description" content="æ—¶ä¸æˆ‘å¾…">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="åŸºäºbge-m3 onnxæ¨¡å‹è·å–ç¨€ç–å‘é‡ | snowdream">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          åŸºäºbge-m3 onnxæ¨¡å‹è·å–ç¨€ç–å‘é‡
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-10-05 10:37:31" itemprop="dateCreated datePublished" datetime="2025-10-05T10:37:31+08:00">2025-10-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%9A%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">ä¸šåŠ¡</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>bge-m3 æ˜¯ç”± BAAI åœ¨ 2024 å¹´æ¨å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„ Embedding æ¨¡å‹ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒå¤šè¯­è¨€çš„ Embedding æ¨¡å‹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒè¾“å‡ºç¨€ç–å‘é‡å’Œ ColBERT å‘é‡ï¼Œå› æ­¤ç”¨é€”æ¯”è¾ƒå¹¿æ³›ã€‚æŒ‰ç…§ç›®å‰ AI æ¨¡å‹çš„å‘å±•é€Ÿåº¦ï¼ˆç«äº‰å¾ˆæ¿€çƒˆï¼‰ï¼Œè¿™ä¸ªæ¨å‡ºäº†ä¸€å¹´å¤šçš„æ¨¡å‹ç†åº”ç®—æ˜¯ä¸ªè€å¤è‘£äº†ï¼Œå®é™…ä¸Šåˆ°ç›®å‰ä¸ºæ­¢ï¼ˆ2025-9-20ï¼‰ï¼Œè¯¥æ¨¡å‹è¿˜èƒ½åœ¨ <a target="_blank" rel="noopener" href="https://huggingface.co/spaces/mteb/leaderboard">MTEB Leaderboard</a> æ¦œå•ä¸Šä¿æŒåœ¨ç¬¬ 23 ä½çš„ä½ç½®ï¼Œä¸”åœ¨ hugging face ä¸Šçš„æœˆä¸‹è½½é‡ä¿æŒåœ¨äº”å…­ç™¾ä¸‡ä¹‹å¤šï¼š</p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202509201703684.png?imageslim" alt="å±€éƒ¨æˆªå–_20250920_170259.png" /></p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202509201703779.png?imageslim" alt="å±€éƒ¨æˆªå–_20250920_170323.png" /></p>
<p>ä¸è¿‡è¯åˆè¯´å›æ¥ï¼Œè¿™å¤§æ¦‚ç‡æ˜¯å› ä¸º Embedding æ¨¡å‹è¿˜æ²¡æœ‰éš”å£ LLM é‚£ä¹ˆå·ï¼Œ2025 æˆªè‡³ç›®å‰ä¹Ÿå°±é˜¿é‡Œæ¨å‡ºçš„ Qwen3-Embedding æ¨¡å‹å¾ˆæœ‰ç«äº‰åŠ›ï¼›</p>
<span id="more"></span>
<h2 id="ä»€ä¹ˆæ˜¯-embedding-æ¨¡å‹"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯-embedding-æ¨¡å‹"></a> ä»€ä¹ˆæ˜¯ Embedding æ¨¡å‹ï¼Ÿ</h2>
<p>ç®€å•åœ°æ¥è¯´ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªè¾“å…¥ï¼ˆæ¯”å¦‚æ–‡æœ¬ï¼Œå›¾åƒç­‰ï¼‰è½¬ä¸ºä¸€ä¸ªé«˜ç»´å‘é‡çš„æ¨¡å‹ï¼Œè¿™ä¸ªå‘é‡å°±ä»£è¡¨äº†è¯¥æ–‡æœ¬çš„ç‰¹å¾å‘é‡ï¼›å…·ä½“åˆ°æ–‡æœ¬çš„ Embeddingï¼Œè¿™äº›ç‰¹å¾å¤§å¤šä¸è¯­ä¹‰å’Œä¸Šä¸‹æ–‡ç›¸å…³ï¼š</p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202509211050304.png?imageslim" alt="image.png" /></p>
<p>å›¾æº <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>
<p>è€Œåœ¨ä¸€ç¯‡æ–‡ç« ä¸­ <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>ï¼Œé‡Œé¢æåŠåˆ°äº† Embedding æ¨¡å‹çš„ä¸¤ä¸ªæ€§è´¨ï¼Œæˆ‘è§‰å¾—æŒºåˆé€‚ï¼š</p>
<blockquote>
<p><strong>æ€§è´¨ä¸€ï¼šæ¯ä¸€ä¸ªè¯å…·æœ‰å”¯ä¸€é‡åŒ–å€¼ï¼Œä¸åŒè¯éœ€è¦å…·æœ‰ä¸åŒçš„é‡åŒ–å€¼</strong><br />
<strong>æ€§è´¨äºŒï¼šè¯ä¹‰ç›¸è¿‘è¯éœ€è¦æœ‰â€œç›¸è¿‘â€çš„é‡åŒ–å€¼ï¼›è¯ä¹‰ä¸ç›¸è¿‘çš„è¯é‡åŒ–å€¼éœ€è¦å°½é‡â€œè¿œç¦»â€</strong></p>
</blockquote>
<p>å…¶å®æˆ‘ä¸€ç›´æŒºå¥½å¥‡ä¸ºå•¥è¦å« Embeddingï¼ˆä¸­æ–‡å«åµŒå…¥ï¼Œå…¶å®æŒºè¿·æƒ‘çš„ï¼Œä¸€å¬å‹æ ¹ä¸çŸ¥é“æŒ‡çš„æ˜¯å•¥ï¼Œå°±è·Ÿé²æ£’æ€§ä¸€æ · ğŸ˜…ï¼‰ï¼Œç„¶ååœ¨ç»´åŸºä¸Šçœ‹åˆ°ä¸€ä¸ªæ•°å­¦ç”¨è¯­ï¼Œæˆ‘è§‰å¾—å¤§æ¦‚å°±æ˜¯å€Ÿé‰´è¿™ä¸ªå§ï¼š</p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202509211203972.png?imageslim" alt="å±€éƒ¨æˆªå–_20250921_120336.png" /></p>
<p>çœ‹äº†è¿™ä¸ªæ•°å­¦ä¸­å…³äºåµŒå…¥çš„å®šä¹‰åï¼Œå°±èƒ½æ˜ç™½å…¶å® Embedding æ¨¡å‹å¹²çš„å°±æ˜¯è¿™ä¸ªæ˜ å°„çš„å·¥ä½œï¼Œå³æŠŠè¾“å…¥æ˜ å°„åˆ°ä¸€ä¸ªå¤šç»´å‘é‡ç©ºé—´ä¸­ã€‚</p>
<p>å…³äº Embedding çš„å…·ä½“åŸç†å…¶å®æˆ‘ä¹Ÿæœ‰å¾ˆå¤šä¸æ‡‚çš„åœ°æ–¹ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸å†è¿‡å¤šèµ˜è¿°äº†ï¼Œä¸è¿‡ä¸‹é¢è¿™ç¯‡æ–‡ç« æˆ‘æ¨èå¯ä»¥é˜…è¯»ä¸€ä¸‹ï¼š</p>
<div class="cardlink-wrapper"><a href="https://zhuanlan.zhihu.com/p/643560252" class="cardlink" target="_blank" rel="noopener noreferrer"><div class="cardlink-content"><div class="cardlink-title">æ²¡æœ‰æ€è€ƒè¿‡ Embeddingï¼Œä¸è¶³ä»¥è°ˆ AI</div><div class="cardlink-description">å’Œå¤§éƒ¨åˆ†äººä¸€æ ·ï¼Œæˆ‘å¯¹è‡ªç„¶è¯­è¨€å¤„ç†å’Œè¯­è¨€æ¨¡å‹çš„äº†è§£ä»ChatGPTå¼€å§‹ã€‚ å’Œå¤§éƒ¨åˆ†äººä¸€æ ·ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦å°±è¢«ChatGPTçš„èƒ½åŠ›æ‰€éœ‡æƒŠ â€”â€” è®¡ç®—æœºç¡®å®åšåˆ°äº†ç†è§£äººç±»çš„è¯­è¨€ã€‚ æˆ‘ä¹Ÿäº§ç”Ÿäº†å‡ ä¹äººäººéƒ½ä¼šæœ‰çš„ç–‘é—®ï¼šæ€ä¹ˆåšåˆ°çš„ï¼Ÿ â€¦</div><div class="cardlink-footer"><span class="cardlink-host">çŸ¥ä¹ä¸“æ </span></div></div></a></div>
<h1 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-onnx-æ¨¡å‹"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-onnx-æ¨¡å‹"></a> ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ onnx æ¨¡å‹ï¼Ÿ</h1>
<blockquote>
<p>ONNXï¼ˆOpen Neural Network Exchangeï¼Œå¼€æ”¾ç¥ç»ç½‘ç»œäº¤æ¢æ ¼å¼ï¼‰æ˜¯ä¸€ç§<strong>è·¨å¹³å°ã€å¼€æºçš„ç¥ç»ç½‘ç»œæ¨¡å‹æ ‡å‡†æ ¼å¼</strong>ï¼Œç”±å¾®è½¯ã€äºšé©¬é€Šã€Facebook ç­‰ä¼ä¸šè”åˆå‘èµ·ã€‚å®ƒå®šä¹‰äº†ç»Ÿä¸€çš„è®¡ç®—å›¾ç»“æ„å’Œå¼ é‡æ•°æ®æ ¼å¼ï¼Œèƒ½å°†ä¸åŒæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆå¦‚ PyTorchã€TensorFlowã€PaddlePaddle ç­‰ï¼‰è®­ç»ƒçš„æ¨¡å‹ â€œç¿»è¯‘â€ æˆç»Ÿä¸€æ ¼å¼ï¼Œå®ç°æ¨¡å‹åœ¨ä¸åŒæ¡†æ¶ã€ç¡¬ä»¶è®¾å¤‡é—´çš„æ— ç¼è¿ç§»ä¸éƒ¨ç½²ã€‚</p>
</blockquote>
<p>å¾ˆç®€å•ï¼Œç”±äºç¡¬ä»¶å—é™ï¼Œæˆ‘éœ€è¦æ”¯æŒåœ¨æŸäº›æ²¡æœ‰ GPU èµ„æºï¼ˆå³çº¯ CPU ç¯å¢ƒï¼‰çš„æœºå™¨ä¸­è¿è¡ŒåŸºäº bge-m3 æ¨¡å‹çš„å‘é‡åŒ–æœåŠ¡ï¼›è™½ç„¶åƒ PyTorch/TensorFlow è¿™ç±»æ¨¡å‹æ–‡ä»¶ä¹Ÿå¯ä»¥åœ¨ CPU ç¯å¢ƒè¿›è¡Œæ¨ç†è¿è¡Œï¼Œä½†æ˜¯ç›¸æ¯” onnx æ¨¡å‹ï¼ˆonnxruntimeï¼‰ä¸“é—¨å¯¹æ¨ç†è¿›è¡Œäº†é€šç”¨çš„ä¼˜åŒ–ï¼Œåªè¦æŠŠè¿™äº›æ¨¡å‹è½¬ä¸º onnx æ¨¡å‹å°±å¯ä»¥è·å¾—å¼€ç®±å³ç”¨çš„æ¨ç†åŠ é€Ÿï¼ˆç›¸æ¯”åŸç”Ÿæ¨¡å‹ï¼Œæ ¹æ®å…·ä½“ç¡¬ä»¶æ¶æ„çš„ä¸åŒï¼Œå¯ä»¥æå‡ 10 å€ç”šè‡³ä¸Šç™¾å€ï¼‰ï¼Œè€Œæ°å¥½ bge-m3 å®˜æ–¹å°±åœ¨æ¨¡å‹ä»“åº“ä¸­æä¾›äº†éé‡åŒ–ç‰ˆæœ¬çš„ onnx æ¨¡å‹æ–‡ä»¶ï¼š</p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202509211221914.png?imageslim" alt="å±€éƒ¨æˆªå–_20250921_122123.png" /></p>
<h2 id="æ¨ç†æ€§èƒ½å¯¹æ¯”"><a class="markdownIt-Anchor" href="#æ¨ç†æ€§èƒ½å¯¹æ¯”"></a> æ¨ç†æ€§èƒ½å¯¹æ¯”</h2>
<p>æˆ‘è®© AI å†™äº†ä¸€æ®µæµ‹è¯•ä»£ç ï¼Œç”¨äºæµ‹è¯•åŸºäºåŸå§‹æ¨¡å‹å’Œ onnx æ¨¡å‹å¯¹åŒæ · Embedding ä»»åŠ¡çš„æ¨ç†é€Ÿåº¦ï¼Œç»“æœå¾ˆå‡ºä¹æˆ‘çš„æ„æ–™ï¼Œæ²¡æƒ³åˆ°æ€§èƒ½æå‡ç™¾å€ä»¥ä¸ŠğŸ˜€ï¼š</p>
<ul>
<li>åŸå§‹æ¨¡å‹ï¼šåŸºäºå®˜æ–¹çš„ FlagEmbedding åº“è¿›è¡Œæ¨ç†</li>
<li>onnx æ¨¡å‹ï¼šåŸºäº onnxruntime åº“è¿›è¡Œæ¨ç†</li>
<li>CPUï¼šIntelÂ® XeonÂ® E-2224G CPU @ 3.50GHz ï¼ˆ4 æ ¸ï¼‰</li>
<li>python ç‰ˆæœ¬ï¼š3.11</li>
</ul>
<h3 id="åŸå§‹æ¨¡å‹çš„æ¨ç†é€Ÿåº¦"><a class="markdownIt-Anchor" href="#åŸå§‹æ¨¡å‹çš„æ¨ç†é€Ÿåº¦"></a> åŸå§‹æ¨¡å‹çš„æ¨ç†é€Ÿåº¦</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">å¼€å§‹æ€§èƒ½æµ‹è¯• - åµŒå…¥ç±»å‹: hybrid, æ¯ä¸ªæµ‹è¯•è¿è¡Œ 5 æ¬¡</span><br><span class="line">==================================================</span><br><span class="line">æ–‡æœ¬é•¿åº¦: 13 å­—ç¬¦, çº¦ 19 tokens</span><br><span class="line">å¹³å‡å¤„ç†æ—¶é—´: 7.0167 ç§’</span><br><span class="line">å¤„ç†é€Ÿåº¦: 2.71 tokens/ç§’</span><br><span class="line">--------------------------------------------------</span><br><span class="line">æ–‡æœ¬é•¿åº¦: 43 å­—ç¬¦, çº¦ 61 tokens</span><br><span class="line">å¹³å‡å¤„ç†æ—¶é—´: 20.2228 ç§’</span><br><span class="line">å¤„ç†é€Ÿåº¦: 3.02 tokens/ç§’</span><br><span class="line">--------------------------------------------------</span><br><span class="line">æ–‡æœ¬é•¿åº¦: 100 å­—ç¬¦, çº¦ 136 tokens</span><br><span class="line">å¹³å‡å¤„ç†æ—¶é—´: 33.7305 ç§’</span><br><span class="line">å¤„ç†é€Ÿåº¦: 4.03 tokens/ç§’</span><br><span class="line">--------------------------------------------------</span><br><span class="line">æ–‡æœ¬é•¿åº¦: 390 å­—ç¬¦, çº¦ 541 tokens</span><br><span class="line">å¹³å‡å¤„ç†æ—¶é—´: 163.0791 ç§’</span><br><span class="line">å¤„ç†é€Ÿåº¦: 3.32 tokens/ç§’</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">æ€»ä½“æ€§èƒ½:</span><br><span class="line">æ€»å¤„ç†tokenæ•°: 757</span><br><span class="line">æ€»å¤„ç†æ—¶é—´: 224.0491 ç§’</span><br><span class="line">å¹³å‡å¤„ç†é€Ÿåº¦: 3.27 tokens/ç§’</span><br></pre></td></tr></table></figure>
<h3 id="onnx-æ¨¡å‹çš„æ¨ç†é€Ÿåº¦"><a class="markdownIt-Anchor" href="#onnx-æ¨¡å‹çš„æ¨ç†é€Ÿåº¦"></a> onnx æ¨¡å‹çš„æ¨ç†é€Ÿåº¦</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">å¼€å§‹æ€§èƒ½æµ‹è¯• - åµŒå…¥ç±»å‹: hybrid, æ¯ä¸ªæµ‹è¯•è¿è¡Œ 5 æ¬¡</span><br><span class="line">==================================================</span><br><span class="line">æ–‡æœ¬é•¿åº¦: 13 å­—ç¬¦, çº¦ 19 tokens</span><br><span class="line">å¹³å‡å¤„ç†æ—¶é—´: 0.0583 ç§’</span><br><span class="line">å¤„ç†é€Ÿåº¦: 325.99 tokens/ç§’</span><br><span class="line">--------------------------------------------------</span><br><span class="line">æ–‡æœ¬é•¿åº¦: 43 å­—ç¬¦, çº¦ 61 tokens</span><br><span class="line">å¹³å‡å¤„ç†æ—¶é—´: 0.0981 ç§’</span><br><span class="line">å¤„ç†é€Ÿåº¦: 621.76 tokens/ç§’</span><br><span class="line">--------------------------------------------------</span><br><span class="line">æ–‡æœ¬é•¿åº¦: 100 å­—ç¬¦, çº¦ 136 tokens</span><br><span class="line">å¹³å‡å¤„ç†æ—¶é—´: 0.1095 ç§’</span><br><span class="line">å¤„ç†é€Ÿåº¦: 1242.13 tokens/ç§’</span><br><span class="line">--------------------------------------------------</span><br><span class="line">æ–‡æœ¬é•¿åº¦: 390 å­—ç¬¦, çº¦ 541 tokens</span><br><span class="line">å¹³å‡å¤„ç†æ—¶é—´: 0.3337 ç§’</span><br><span class="line">å¤„ç†é€Ÿåº¦: 1621.42 tokens/ç§’</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">æ€»ä½“æ€§èƒ½:</span><br><span class="line">æ€»å¤„ç†tokenæ•°: 757</span><br><span class="line">æ€»å¤„ç†æ—¶é—´: 0.5995 ç§’</span><br><span class="line">å¹³å‡å¤„ç†é€Ÿåº¦: 952.83 tokens/ç§’</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h2>
<p>ä¸éš¾çœ‹å‡ºåœ¨ä½¿ç”¨åŸå§‹æ¨¡å‹åœ¨çº¯ CPU ç¯å¢ƒä¸‹è¿›è¡Œæ¨ç†çš„é€Ÿåº¦å®åœ¨æ˜¯å¾ˆæ…¢ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºå•¥è¦è¿›è¡Œä¼˜åŒ–çš„åŸå› ï¼Œè¿™ç§æ¨ç†é€Ÿåº¦å®åœ¨æ— æ³•åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­è¿›è¡Œä½¿ç”¨ï¼‰ï¼Œè€Œä»…ä»…åªæ˜¯æŠŠæ¨¡å‹åˆ‡æ¢ä¸º onnx å°±èƒ½å¾—åˆ°ä¸Šç™¾å€çš„æ€§èƒ½æå‡ï¼Œåªèƒ½è¯´ onnx æ¨¡å‹è‡ªå¸¦çš„æ¨ç†ä¼˜åŒ–å¾ˆæƒŠäººã€‚</p>
<p>ä¸è¿‡å®é™…ä¸Šåœ¨å¦ä¸€ç§ CPU è§„æ ¼ï¼ˆæµ·å…‰çš„æŸæ¬¾ 8 æ ¸ CPUï¼‰ä¸Šè¿›è¡ŒåŒæ ·çš„æµ‹è¯•æ—¶ï¼Œå‘ç°æ€§èƒ½æå‡å¹¶æ²¡æœ‰ä¸Šé¢çš„é‚£ä¹ˆæ˜¾è‘—ï¼Œå¤§æ¦‚æ˜¯ç¼ºå°‘äº†æŸäº›åº•å±‚çŸ©é˜µåŠ é€Ÿåº“å’ŒæŒ‡ä»¤é›†çš„æ”¯æŒã€‚</p>
<h1 id="bge-m3-ç¨€ç–å‘é‡çš„è®¡ç®—"><a class="markdownIt-Anchor" href="#bge-m3-ç¨€ç–å‘é‡çš„è®¡ç®—"></a> bge-m3 ç¨€ç–å‘é‡çš„è®¡ç®—</h1>
<p>ä½¿ç”¨ bge-m3 çš„ onnx æ¨¡å‹å”¯ä¸€çš„é—®é¢˜å°±æ˜¯ï¼Œæ— æ³•ç›´æ¥è·å–åˆ°å…¶ç¨€ç–å‘é‡å’Œ colbert å‘é‡çš„è¾“å‡ºäº†ï¼Œå› ä¸º bge å®˜æ–¹æä¾›çš„æ¨ç†åº“â€”â€”FlagEmbedding å¯ä»¥ç›´æ¥é€šè¿‡ return_denseã€return_sparse å’Œ return_colbert_vecs è¿™ä¸‰ä¸ªå‚æ•°æ¥æ§åˆ¶è¾“å‡ºçš„å‘é‡ç±»å‹ï¼Œè€Œ onnxruntime å¾—åˆ°çš„ç»“æœåªæ˜¯ç¨ å¯†å‘é‡ã€‚å› æ­¤ä½¿ç”¨ onnx æ¨¡å‹æ—¶æƒ³è¦å¾—åˆ° bge-m3 çš„ç¨€ç–å‘é‡ï¼Œå°±å¾—è‡ªè¡ŒæŒ‰ç…§è¯¥æ¨¡å‹åœ¨è®ºæ–‡ä¸­æå‡ºçš„ç¨€ç–å‘é‡è®¡ç®—å…¬å¼è¿›è¡Œå®ç° <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>ï¼š</p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202510041615944.png?imageslim" alt="å±€éƒ¨æˆªå–_20251004_161514.png" /></p>
<p>åœ¨ä¸€å¼€å§‹æˆ‘å¹¶ä¸çŸ¥é“ bge-m3 æœ‰è‡ªå·±çš„ç¨€ç–å‘é‡è®¡ç®—å…¬å¼ï¼Œäºæ˜¯è®© AI éšä¾¿å†™äº†ä¸€ä¸ªç¨€ç–å‘é‡è®¡ç®—çš„ç®—æ³•å®ç°ï¼Œç„¶åè¾“å‡ºçš„ç»“æœçœ‹èµ·æ¥ä¹Ÿæƒ³é‚£ä¹ˆå›äº‹ï¼Œç»“æœåé¢ä¸€å¯¹æ¯”ä¹‹å‰çš„è¾“å‡ºå‘ç°æƒé‡ç»“æœå®Œå…¨å¯¹ä¸ä¸Šï¼Œåªèƒ½è¯´æœ‰ç‚¹å¤ªè‰ºé«˜äººèƒ†å¤§äº†ï¼ˆä¸€ä¸ªæ•¢å†™ï¼Œä¸€ä¸ªæ•¢ä¿¡ï¼Œè¿™å°±æ˜¯ä¸ºå•¥ç¢°åˆ°ä¸æ‡‚çš„é¢†åŸŸæ—¶ä¼šå‡ºç°è¢« AI è’™ä½çš„æƒ…å†µğŸ˜‚ï¼‰</p>
<h2 id="ä»£ç å®ç°"><a class="markdownIt-Anchor" href="#ä»£ç å®ç°"></a> ä»£ç å®ç°</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_compute_lexical_weights_v2</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        hidden_state: np.ndarray,</span></span><br><span class="line"><span class="params">        input_ids: <span class="built_in">list</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">        return_embedding: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">float</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        source: https://zhuanlan.zhihu.com/p/1889076509584638806</span></span><br><span class="line"><span class="string">        åŸºäºBGE-M3åŸå§‹ç®—æ³•è®¡ç®—è¯æ±‡æƒé‡</span></span><br><span class="line"><span class="string">        å®ç°å…¬å¼: w_qt = ReLU(W_lex * H_q[i])</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            hidden_state: token embeddings, shape (seq_len, hidden_size)</span></span><br><span class="line"><span class="string">            input_ids: token IDåˆ—è¡¨</span></span><br><span class="line"><span class="string">            return_embedding: æ˜¯å¦è¿”å›å®Œæ•´çš„sparse embeddingï¼ˆå½“å‰æ€»æ˜¯è¿”å›å­—å…¸ï¼‰</span></span><br><span class="line"><span class="string">          </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            è¯æ±‡æƒé‡å­—å…¸ï¼Œé”®ä¸ºå­—ç¬¦ä¸²å½¢å¼çš„token IDï¼Œå€¼ä¸ºæƒé‡</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># å°†numpyæ•°ç»„è½¬æ¢ä¸ºtorch tensor</span></span><br><span class="line">        hidden_state_tensor = torch.from_numpy(hidden_state).<span class="built_in">float</span>()</span><br><span class="line">        input_ids_tensor = torch.tensor(input_ids, dtype=torch.long)</span><br><span class="line">      </span><br><span class="line">        <span class="comment"># è®¡ç®—tokenæƒé‡ï¼šReLU(sparse_linear(hidden_state))</span></span><br><span class="line">        token_weights = torch.relu(<span class="variable language_">self</span>.sparse_linear(hidden_state_tensor))</span><br><span class="line">        token_weights = token_weights.squeeze(-<span class="number">1</span>)  <span class="comment"># å»é™¤æœ€åä¸€ä¸ªç»´åº¦ (seq_len, 1) -&gt; (seq_len,)</span></span><br><span class="line">      </span><br><span class="line">        <span class="comment"># åˆ›å»ºç¨€ç–åµŒå…¥çŸ©é˜µ</span></span><br><span class="line">        sparse_embedding = torch.zeros(</span><br><span class="line">            <span class="variable language_">self</span>.vocab_size,</span><br><span class="line">            dtype=token_weights.dtype,</span><br><span class="line">            device=token_weights.device</span><br><span class="line">        )</span><br><span class="line">      </span><br><span class="line">        <span class="comment"># ä½¿ç”¨scatteræ“ä½œå°†tokenæƒé‡åˆ†é…åˆ°å¯¹åº”çš„token IDä½ç½®</span></span><br><span class="line">        sparse_embedding = sparse_embedding.scatter(<span class="number">0</span>, input_ids_tensor, token_weights)</span><br><span class="line">      </span><br><span class="line">        <span class="comment"># è½¬æ¢ä¸ºå­—å…¸æ ¼å¼ï¼Œåªä¿ç•™éé›¶æƒé‡</span></span><br><span class="line">        result = defaultdict(<span class="built_in">float</span>)</span><br><span class="line">        <span class="keyword">for</span> token_id <span class="keyword">in</span> input_ids:</span><br><span class="line">            weight = sparse_embedding[token_id].item()</span><br><span class="line">            <span class="keyword">if</span> weight &gt; <span class="number">0</span> <span class="keyword">and</span> token_id <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.special_tokens:</span><br><span class="line">                result[<span class="built_in">str</span>(token_id)] = <span class="built_in">max</span>(result[<span class="built_in">str</span>(token_id)], weight)</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ hidden_state å°±æ˜¯ token çº§åˆ«çš„ç¨ å¯†å‘é‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†è¯</span></span><br><span class="line">inputs = <span class="variable language_">self</span>.tokenizer(</span><br><span class="line">	texts,</span><br><span class="line">	padding=<span class="string">&quot;longest&quot;</span>,</span><br><span class="line">	truncation=<span class="literal">True</span>,</span><br><span class="line">	max_length=max_length,</span><br><span class="line">	return_tensors=<span class="string">&quot;np&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢ä¸ºONNXè¾“å…¥æ ¼å¼</span></span><br><span class="line">inputs_onnx = &#123;k: ort.OrtValue.ortvalue_from_numpy(v) <span class="keyword">for</span> k, v <span class="keyword">in</span> inputs.items()&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨ç†</span></span><br><span class="line">outputs = <span class="variable language_">self</span>.ort_session.run(<span class="literal">None</span>, inputs_onnx)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–tokençº§åˆ«çš„embeddingså’Œå¥å­çº§åˆ«çš„embedding</span></span><br><span class="line">token_embeddings = outputs[<span class="number">0</span>]  <span class="comment"># shape: (batch_size, seq_len, hidden_size)</span></span><br><span class="line">sentence_embeddings = outputs[<span class="number">1</span>]  <span class="comment"># shape: (batch_size, hidden_size)</span></span><br></pre></td></tr></table></figure>
<h2 id="sparse_linear-çš„ä½œç”¨"><a class="markdownIt-Anchor" href="#sparse_linear-çš„ä½œç”¨"></a> sparse_linear çš„ä½œç”¨</h2>
<p>å®é™…ä¸Šå¯¹åº”çš„å°±æ˜¯å…¬å¼ä¸­çš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>l</mi><mi>e</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W_{lex}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå³ä¸€ä¸ªç‰¹æ®Šçš„çº¿æ€§å±‚ <sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>ï¼š</p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202509181018918.png?imageslim" alt="image.png" /></p>
<blockquote>
<p>çº¿æ€§å˜æ¢ï¼šåœ¨ç¼–ç å™¨æ ˆçš„è¾“å‡ºä¸Šæ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„çº¿æ€§å±‚ã€‚é€šè¿‡æ­¤å±‚è®¡ç®—æ¯ä¸ª Token çš„é‡è¦æ€§æƒé‡ï¼ŒBGE-M3 å¾—åˆ°äº†ä¸€ç»„æƒé‡ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>l</mi><mi>e</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W_{lex}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼‰ã€‚</p>
</blockquote>
<p>å®é™…ä¸Šè¿™ä¸ªç‰¹æ®Šçš„çº¿æ€§å±‚å°±æ˜¯æŠŠæ¯ä¸ª token çš„ hidden state è½¬ä¸ºä¸€ä¸ªä¸€ç»´çš„æƒé‡å€¼ï¼Œçº¿æ€§å±‚æ˜¯é¢„è®­ç»ƒå¾—åˆ°åˆ°æ¯ä¸ª token åœ¨ä¸Šä¸‹æ–‡ä¸­çš„é‡è¦æ€§ï¼Œå› æ­¤åŸºäºçº¿æ€§å±‚çš„è½¬æ¢å¯ä»¥å¾—åˆ°è¯¥ token åœ¨ä¸Šä¸‹æ–‡ä¸­çš„æƒé‡ã€‚å¦‚æœæŠŠè¿™ä¸ªçº¿æ€§å±‚æ›¿æ¢æˆ<strong>è‡ªå®šä¹‰çš„æƒé‡</strong>ï¼Œåˆ™å¯ä»¥å¾—åˆ°è‡ªå®šä¹‰çš„ç¨€ç–å‘é‡ï¼ˆå³å¯ä»¥è‡ªå®šä¹‰å…·ä½“åˆ†è¯çš„é‡è¦æ€§ï¼‰ã€‚</p>
<p>è¯¥æƒé‡æ–‡ä»¶åœ¨ bge-m3 ä»“åº“çš„é¡¶å±‚ç›®å½•ä¸­ï¼š</p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202510041703815.png?imageslim" alt="å±€éƒ¨æˆªå–_20251004_170242.png" /></p>
<p>å¯ä»¥ä½¿ç”¨ pytorch ç›´æ¥è¯»å–ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">self</span>.sparse_linear = torch.nn.Linear(</span><br><span class="line">	in_features=<span class="variable language_">self</span>.hidden_size,  <span class="comment"># ä½¿ç”¨æ­£ç¡®çš„hidden_size</span></span><br><span class="line">	out_features=<span class="number">1</span></span><br><span class="line">)</span><br><span class="line">sparse_linear_path = os.path.join(model_path, <span class="string">&quot;sparse_linear.pt&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> os.path.exists(sparse_linear_path):</span><br><span class="line">	<span class="variable language_">self</span>.sparse_linear.load_state_dict(torch.load(sparse_linear_path, map_location=<span class="string">&#x27;cpu&#x27;</span>, weights_only=<span class="literal">True</span>))</span><br><span class="line">	logger.info(<span class="string">f&quot;æˆåŠŸåŠ è½½sparse_linearæƒé‡: <span class="subst">&#123;sparse_linear_path&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	logger.info(<span class="string">f&quot;sparse_linear.pt not found, using default weights&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ä»æ‰“å°ç»“æœæ¥çœ‹ï¼Œsparse_linear æƒé‡æ–‡ä»¶çš„ç»´åº¦è·Ÿç¨ å¯†å‘é‡è¾“å‡ºçš„ç»´åº¦ä¸€è‡´ï¼Œå³ 1024ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">embedding_models/bge-m3/sparse_linear.pt, torch.Size([1, 1024])</span><br></pre></td></tr></table></figure>
<h2 id="ç‰¹æ®Šå­—ç¬¦çš„å¤„ç†"><a class="markdownIt-Anchor" href="#ç‰¹æ®Šå­—ç¬¦çš„å¤„ç†"></a> ç‰¹æ®Šå­—ç¬¦çš„å¤„ç†</h2>
<p>åœ¨åŸºäºä¸Šè¿°å…¬å¼è®¡ç®—å¾—åˆ°è¾“å…¥æ–‡æœ¬çš„ç¨€ç–å‘é‡æ—¶ï¼Œæˆ‘å‘ç°æœ‰ä¸€ä¸ªç‰¹å®šç»´åº¦çš„æƒé‡å€¼å¼‚å¸¸çš„é«˜ï¼Œä¸”æ¯ä¸ªè¾“å…¥æ–‡æœ¬è¯¥ç»´åº¦éƒ½å­˜åœ¨ï¼Œå› æ­¤ä¼šå¯¼è‡´åŸºäºç¨€ç–å‘é‡çš„æœç´¢ç›¸ä¼¼åº¦è¿‡é«˜ï¼Œä»è€ŒåŒ¹é…ç»“æœä¸å‡†ç¡®çš„é—®é¢˜ã€‚åé¢ç»è¿‡æ’æŸ¥ï¼Œå‘ç°åŸæ¥æ˜¯æœ‰ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦å¹¶æ²¡æœ‰åŒ…å«åˆ° <code>special_tokens_map.json</code> æ‰€å¯¼è‡´çš„ï¼Œè¿™ä¸ªç‰¹æ®Šå­—ç¬¦å°±æ˜¯ SentencePieceï¼ˆè¯æ±‡åˆ†ç•Œæ ‡è®°ï¼‰ï¼Œåœ¨ bge-m3 æ¨¡å‹ä¸­çš„ token id ä¸º 6ï¼š</p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202506031624598.png?imageslim" alt="å±€éƒ¨æˆªå–_20250603_162419.png" /></p>
<p><img src="https://pic.xiexuefeng.cc/markdown/202506031629640.png?imageslim" alt="å±€éƒ¨æˆªå–_20250603_162907.png" /></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bge-m3æ¨¡å‹çš„special_tokens_map.jsonæ–‡ä»¶</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;bos_token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;s&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;normalized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;single_word&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cls_token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;s&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;normalized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;single_word&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;eos_token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;/s&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;normalized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;single_word&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mask_token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;mask&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;normalized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;single_word&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pad_token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;pad&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;normalized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;single_word&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sep_token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;/s&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;normalized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;single_word&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;unk_token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;unk&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;normalized&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rstrip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;single_word&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>å› æ­¤éœ€è¦åœ¨åŠ è½½æ¨¡å‹çš„é˜¶æ®µï¼Œæ‰‹åŠ¨æŠŠ SentencePiece å­—ç¬¦åŠ å…¥åˆ°ç‰¹æ®Šå­—ç¬¦åˆ—è¡¨ä¸­ï¼Œç„¶ååœ¨è®¡ç®—ç¨€ç–å‘é‡æ—¶å°±å¯ä»¥è·³è¿‡è¯¥ token çš„æƒé‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼“å­˜ç‰¹æ®Štoken IDï¼Œå‚è€ƒbge-m3çš„special_tokens_map.json</span></span><br><span class="line"><span class="variable language_">self</span>.special_tokens = <span class="built_in">set</span>([</span><br><span class="line">	<span class="variable language_">self</span>.tokenizer.cls_token_id,</span><br><span class="line">	<span class="variable language_">self</span>.tokenizer.sep_token_id,</span><br><span class="line">	<span class="variable language_">self</span>.tokenizer.pad_token_id,</span><br><span class="line">	<span class="variable language_">self</span>.tokenizer.mask_token_id,</span><br><span class="line">	<span class="variable language_">self</span>.tokenizer.unk_token_id,</span><br><span class="line">	<span class="variable language_">self</span>.tokenizer.bos_token_id,</span><br><span class="line">	<span class="variable language_">self</span>.tokenizer.eos_token_id,</span><br><span class="line">])</span><br><span class="line">logger.info(<span class="string">f&quot;ç‰¹æ®Štokené›†åˆ: <span class="subst">&#123;self.special_tokens&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ SentencePieceè¾¹ç•Œæ ‡è®°token</span></span><br><span class="line"><span class="comment"># æ£€æŸ¥å¸¸è§çš„SentencePieceè¾¹ç•Œæ ‡è®°</span></span><br><span class="line">boundary_tokens = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;ã€‘&#x27;</span>, <span class="string">&#x27;[UNK]&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> token <span class="keyword">in</span> boundary_tokens:</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		token_id = <span class="variable language_">self</span>.tokenizer.convert_tokens_to_ids(token)</span><br><span class="line">		<span class="keyword">if</span> token_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> token_id != <span class="variable language_">self</span>.tokenizer.unk_token_id:</span><br><span class="line">			<span class="variable language_">self</span>.special_tokens.add(token_id)</span><br><span class="line">			logger.info(<span class="string">f&quot;æ·»åŠ SentencePieceè¾¹ç•Œtoken &#x27;<span class="subst">&#123;token&#125;</span>&#x27; (ID: <span class="subst">&#123;token_id&#125;</span>) åˆ°ç‰¹æ®Štokené›†åˆ&quot;</span>)</span><br><span class="line">	<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">		logger.error(<span class="string">f&quot;æ·»åŠ SentencePieceè¾¹ç•Œtoken &#x27;<span class="subst">&#123;token&#125;</span>&#x27; å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‰¹åˆ«å¤„ç†ï¼šå¦‚æœtoken ID 6å¯¹åº” å­—ç¬¦ï¼Œç¡®ä¿å°†å…¶æ·»åŠ ä¸ºç‰¹æ®Štoken</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	token_6_str = <span class="variable language_">self</span>.tokenizer.convert_ids_to_tokens([<span class="number">6</span>])[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">if</span> token_6_str <span class="keyword">in</span> [<span class="string">&#x27;â–&#x27;</span>, <span class="string">&#x27;_&#x27;</span>]:</span><br><span class="line">		<span class="variable language_">self</span>.special_tokens.add(<span class="number">6</span>)</span><br><span class="line">		logger.info(<span class="string">f&quot;ç¡®è®¤æ·»åŠ è¾¹ç•Œtoken ID 6 (&#x27;<span class="subst">&#123;token_6_str&#125;</span>&#x27;) ä¸ºç‰¹æ®Štoken&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h1 id="æ‰©å±•é˜…è¯»learned-sparse-embedding"><a class="markdownIt-Anchor" href="#æ‰©å±•é˜…è¯»learned-sparse-embedding"></a> æ‰©å±•é˜…è¯»ï¼šLearned Sparse Embedding</h1>
<p>ç”±äº bge-m3 æ¨¡å‹ä¸­ sparse_linear çš„å­˜åœ¨ï¼Œå› æ­¤å…¶è®¡ç®—å¾—åˆ°çš„ç¨€ç–å‘é‡å·²ç»ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸ŠåŸºäºç»Ÿè®¡æ–¹æ³•ï¼ˆå¦‚ BM25ï¼‰å¾—åˆ°çš„åˆ†è¯æƒé‡äº†ï¼Œè¿™ç±»åŸºäºæœºå™¨å­¦ä¹ æ–¹æ³•è®¡ç®—å¾—åˆ°çš„ç¨€ç– Embedding è¢«ç§°ä¸º Learned Sparse Embeddingï¼›è¯¦ç»†å†…å®¹æ¨èé˜…è¯»ä¸‹é¢çš„æ–‡ç« ï¼š</p>
<div class="cardlink-wrapper"><a href="https://zilliz.com/learn/bge-m3-and-splade-two-machine-learning-models-for-generating-sparse-embeddings" class="cardlink" target="_blank" rel="noopener noreferrer"><div class="cardlink-image"><img src="https://assets.zilliz.com/Exploring_BGE_M3_and_Splade_Two_Machine_Learning_Models_for_Generating_Sparse_Embeddings_a3065f09cd.png" alt="BGE-M3 and Splade: Two Popular Sparse Embedding Models - Zilliz Learn" loading="lazy"></div><div class="cardlink-content"><div class="cardlink-title">BGE-M3 and Splade: Two Popular Sparse Embedding Models - Zilliz Learn</div><div class="cardlink-description">In this blog, weâ€™ve journeyed through the intricate world of vector embeddings and explored how BGE-M3 and Splade generate learned sparse embeddings.</div><div class="cardlink-footer"><img src="https://zilliz.com/favicon.svg" class="cardlink-favicon" alt=""><span class="cardlink-host">zilliz.com</span></div></div></a></div>
<div class="cardlink-wrapper"><a href="https://zilliz.com/learn/enhancing-information-retrieval-learned-sparse-embeddings" class="cardlink" target="_blank" rel="noopener noreferrer"><div class="cardlink-image"><img src="https://assets.zilliz.com/Enhancing_Information_Retrieval_with_Learned_Sparse_Embeddings_a89ddba8f8.png" alt="Enhancing Information Retrieval with Sparse Embeddings | Zilliz Learn - Zilliz Learn" loading="lazy"></div><div class="cardlink-content"><div class="cardlink-title">Enhancing Information Retrieval with Sparse Embeddings | Zilliz Learn - Zilliz Learn</div><div class="cardlink-description">Explore the inner workings, advantages, and practical applications of learned sparse embeddings with the Milvus vector database</div><div class="cardlink-footer"><img src="https://zilliz.com/favicon.svg" class="cardlink-favicon" alt=""><span class="cardlink-host">zilliz.com</span></div></div></a></div>
<h2 id="spade"><a class="markdownIt-Anchor" href="#spade"></a> spade</h2>
<p><img src="https://pic.xiexuefeng.cc/markdown/202509181026829.png?imageslim" alt="image.png" /></p>
<p>è¿™æ˜¯å¦ä¸€ç§ä¸åŒäº bge-m3 æ¨¡å‹è®¡ç®—ç¨€ç–å‘é‡çš„ Learned Sparse Embedding æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ä»…å¯ä»¥å¾—åˆ°å½“å‰è¾“å…¥çš„ token çš„æƒé‡å€¼ï¼Œè¿˜å¯ä»¥å¾—åˆ°ç›¸åŒè¯­ä¹‰ï¼ˆåŒä¸€ä¸Šä¸‹æ–‡ä¸­ï¼‰çš„æ²¡æœ‰å‡ºç°çš„ token çš„æƒé‡å€¼ã€‚</p>
<p>è¯¥æ–¹æ³•æœ€åé€šè¿‡ç»Ÿè®¡æ¯ä¸ª token åœ¨å…¶ä½ç½®ä¸Š<strong>æ‰€æœ‰</strong>token å‡ºç°çš„æ¦‚ç‡å¾—åˆ°ç¨€ç–å‘é‡æƒé‡ã€‚</p>
<hr class="footnotes-sep" />
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_53269650/article/details/147872394">æ·±å…¥ç†è§£Embedding Modelsï¼ˆåµŒå…¥æ¨¡å‹ï¼‰ï¼šä»åŸç†åˆ°å®æˆ˜ï¼ˆä¸‹ï¼‰</a> <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn2" class="footnote-item"><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/643560252">æ²¡æœ‰æ€è€ƒè¿‡ Embeddingï¼Œä¸è¶³ä»¥è°ˆ AI</a> <a href="#fnref2" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn3" class="footnote-item"><p><a target="_blank" rel="noopener" href="https://bge-model.com/bge/bge_m3.html">https://bge-model.com/bge/bge_m3.html</a> <a href="#fnref3" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn4" class="footnote-item"><p><a target="_blank" rel="noopener" href="https://zilliz.com/learn/bge-m3-and-splade-two-machine-learning-models-for-generating-sparse-embeddings">https://zilliz.com/learn/bge-m3-and-splade-two-machine-learning-models-for-generating-sparse-embeddings</a> <a href="#fnref4" class="footnote-backref">â†©ï¸</a></p>
</li>
</ol>
</section>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>xuefeng
  </li>
  <li class="post-copyright-link">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://note.xiexuefeng.cc/post/sparse-vector-generation-with-bge-m3-onnx/" title="åŸºäºbge-m3 onnxæ¨¡å‹è·å–ç¨€ç–å‘é‡">https://note.xiexuefeng.cc/post/sparse-vector-generation-with-bge-m3-onnx/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/AI/" rel="tag"># AI</a>
              <a href="/tags/RAG/" rel="tag"># RAG</a>
              <a href="/tags/Embedding/" rel="tag"># Embedding</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/modded-pbr-rendering-multi-light-optimization/" rel="prev" title="é­”æ”¹PBRæ¸²æŸ“ç®¡çº¿æ”¯æŒå¤§é‡ç¯å…‰åœºæ™¯">
                  <i class="fa fa-chevron-left"></i> é­”æ”¹PBRæ¸²æŸ“ç®¡çº¿æ”¯æŒå¤§é‡ç¯å…‰åœºæ™¯
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/ocr-text-orientation-correction-bbox-statistic/" rel="next" title="åŸºäºBounding Boxå’Œç»Ÿè®¡æ–¹æ³•çŸ«æ­£OCRæ–‡æœ¬çš„æ–¹å‘">
                  åŸºäºBounding Boxå’Œç»Ÿè®¡æ–¹æ³•çŸ«æ­£OCRæ–‡æœ¬çš„æ–¹å‘ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
  <div class="languages">
    <label class="lang-select-label">
      <i class="fa fa-language"></i>
      <span>ç®€ä½“ä¸­æ–‡</span>
      <i class="fa fa-angle-up" aria-hidden="true"></i>
    </label>
    <select class="lang-select" data-canonical="" aria-label="é€‰æ‹©è¯­è¨€">
      
        <option value="zh-CN" data-href="/post/sparse-vector-generation-with-bge-m3-onnx/" selected="">
          ç®€ä½“ä¸­æ–‡
        </option>
      
        <option value="en" data-href="/en/post/sparse-vector-generation-with-bge-m3-onnx/" selected="">
          English
        </option>
      
    </select>
  </div>


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xuefeng</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>
  <script src='https://unpkg.com/mermaid@11.6.0/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'default' });
    }
  </script>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.2/katex.min.css" integrity="sha256-oWCabCfPd4Oi21wqZezBSz/anto4VYcJqc9sM9IzQTk=" crossorigin="anonymous">


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"xxf1996/hexo-comment","issue_term":"pathname","theme":"github-dark"}</script>
<script src="/js/third-party/comments/utterances.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
